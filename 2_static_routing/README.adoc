= Static Routing
Rudi Swennen
:doctype: article
:encoding: utf-8
:lang: nl
:toc: left


= Statische Routes IPv4

Ik ga volgend netwerk opbouwen in GNS3:

image::images/image1.png[]

== Router R1
    /system identity set name=R1
    /ip address
    add address=192.168.0.1/24 interface=ether1 network=192.168.0.0 
    add address=10.0.0.1/24    interface=ether2 network=10.0.0.0
    add address=10.0.3.2/24    interface=ether3 network=10.0.3.0
    /ip route
    add distance=1 dst-address=192.168.10.0/24 gateway=10.0.0.2
    add distance=1 dst-address=192.168.20.0/24 gateway=10.0.0.2
    add distance=1 dst-address=192.168.20.0/24 gateway=10.0.3.1
    add distance=1 dst-address=192.168.30.0/24 gateway=10.0.3.1

Check:

    ip add   print
    ip route print

== Router R2
    /system identity set name=R2
    /ip address
    add address=192.168.10.1/24 interface=ether1 network=192.168.10.0 
    add address=10.0.1.1/24     interface=ether2 network=10.0.1.0
    add address=10.0.0.2/24     interface=ether3 network=10.0.0.0
    /ip route
    add distance=1 dst-address=192.168.0.0/24  gateway=10.0.0.1
    add distance=1 dst-address=192.168.30.0/24 gateway=10.0.0.1
    add distance=1 dst-address=192.168.30.0/24 gateway=10.0.1.2
    add distance=1 dst-address=192.168.20.0/24 gateway=10.0.1.2

Check:

    ip add   print
    ip route print

== Router R3
    /system identity set name=R3
    /ip address
    add address=192.168.20.1/24 interface=ether1 network=192.168.20.0 
    add address=10.0.2.1/24     interface=ether2 network=10.0.2.0
    add address=10.0.1.2/24     interface=ether3 network=10.0.1.0
    /ip route
    add distance=1 dst-address=192.168.10.0/24 gateway=10.0.1.1
    add distance=1 dst-address=192.168.0.0/24  gateway=10.0.1.1
    add distance=1 dst-address=192.168.0.0/24  gateway=10.0.2.2
    add distance=1 dst-address=192.168.30.0/24 gateway=10.0.2.2

Check:

    ip add   print
    ip route print

== Router R4
    /system identity set name=R4
    /ip address
    add address=192.168.30.1/24 interface=ether1 network=192.168.30.0 
    add address=10.0.3.1/24     interface=ether2 network=10.0.3.0
    add address=10.0.2.2/24     interface=ether3 network=10.0.2.0
    /ip route
    add distance=1 dst-address=192.168.0.0/24  gateway=10.0.3.2
    add distance=1 dst-address=192.168.10.0/24 gateway=10.0.3.2
    add distance=1 dst-address=192.168.10.0/24 gateway=10.0.2.1
    add distance=1 dst-address=192.168.20.0/24 gateway=10.0.2.1

Check:

    ip add   print
    ip route print


= Statische Routes IPv6
Statische routes in IPv4 gingen verbasend goed, nu hetzelfde maar in IPv6. Mikrotik geeft mij **niet de mogelijkheid** om de interfaces een vast link-local adres te geven. 
IPv6 is standaard niet geactiveerd, voer daarom volgende commando' uit op alle routers:
    
    system package print
    system package enable numbers=2 # Als nummer 2 het ipv6 pakket is waar een X voor staat.  
    system reboot

Controller of IPv6 actief is met volgend commando (je zal link-local adressen zien staan die beginnen met fe80)

    ipv6 address print

en ping de andere nodes om de connectiviteit te testen (vergeet de interface niet mee te geven als je pint naar een link-local adres), hieronder een voorbeeld

    ping fe80::e39:9bff:fe75:2602%ether2

Volgend netwerk zal opgebouwd worden:

image::images/image2.png[]

== Router R1
    /ipv6 address
    add address=2001:db8:0:0::1/64 interface=ether1  
    /ipv6 route
    add distance=1 dst-address=2001:db8:0:1::/64 gateway=fe80::e39:9bff:fe75:2602%ether2
    add distance=1 dst-address=2001:db8:0:2::/64 gateway=fe80::e39:9bff:fe75:2602%ether2
    add distance=1 dst-address=2001:db8:0:2::/64 gateway=fe80::e39:9bff:febb:2401%ether3
    add distance=1 dst-address=2001:db8:0:3::/64 gateway=fe80::e39:9bff:febb:2401%ether3

Check:

    ipv6 add   print
    ipv6 route print

== Router R2
    /ipv6 address
    add address=2001:db8:0:1::1/64 interface=ether1
    /ipv6 route
    add distance=1 dst-address=2001:db8:0:0::/64 gateway=fe80::e39:9bff:fea4:3901%ether3
    add distance=1 dst-address=2001:db8:0:3::/64 gateway=fe80::e39:9bff:fea4:3901%ether3
    add distance=1 dst-address=2001:db8:0:3::/64 gateway=fe80::e39:9bff:fec1:b902%ether2
    add distance=1 dst-address=2001:db8:0:2::/64 gateway=fe80::e39:9bff:fec1:b902%ether2

Check:

    ipv6 add   print
    ipv6 route print

== Router R3
    /ipv6 address
    add address=2001:db8:0:2::1/64 interface=ether1
    /ipv6 route
    add distance=1 dst-address=2001:db8:0:1::/64  gateway=fe80::e39:9bff:fe75:2601%ether3
    add distance=1 dst-address=2001:db8:0:0::/64  gateway=fe80::e39:9bff:fe75:2601%ether3
    add distance=1 dst-address=2001:db8:0:0::/64  gateway=fe80::e39:9bff:febb:2402%ether2
    add distance=1 dst-address=2001:db8:0:3::/64  gateway=fe80::e39:9bff:febb:2402%ether2

Check:

    ipv6 add   print
    ipv6 route print

== Router R4
    /ipv6 address
    add address=2001:db8:0:3::1/64 interface=ether1 
    /ipv6 route
    add distance=1 dst-address=2001:db8:0:0::/64  gateway=fe80::e39:9bff:fea4:3902%ether2
    add distance=1 dst-address=2001:db8:0:1::/64  gateway=fe80::e39:9bff:fea4:3902%ether2
    add distance=1 dst-address=2001:db8:0:1::/64  gateway=fe80::e39:9bff:fec1:b901%ether3
    add distance=1 dst-address=2001:db8:0:2::/64  gateway=fe80::e39:9bff:fec1:b901%ether3

Check:

    ipv6 add   print
    ipv6 route print

== Feedback
Na twee uur zoeken uiteindelijk gevonden dat de PC's in GNS3 de RA van Mikrotik niet aanvaarden en dat je ND expliciet moet aanzetten op een interface in Mikrotik. ARGH ARGH ARGH

IMPORTANT: uitzoeken of de PC's van GNS3 dat bij alle RA-routers hebben? De RA van Mikrotik ziet per perfect uit. 

= Router on a stick
Volgend netwerk zal opgebouwd worden:

image::images/image4.png[]

PC1 zit in VLAN 10, PC2 zit in VLAN2 0, PC3 zit in VLAN 1. De ether1 interface van de router is voorzien van twee VLAN-sub-interfaces LEFT (VID 10) en RIGHT (VID 20). Untagged traffic (native VLAN) komt terecht op ether0.

De configuratie van Router R1:

    /interface vlan
    add interface=ether1 name=LEFT vlan-id=10
    add interface=ether1 name=RIGHT vlan-id=20
    /ip address
    add address=10.0.0.1/24 interface=LEFT network=10.0.0.0
    add address=20.0.0.1/24 interface=RIGHT network=20.0.0.0
    add address=99.0.0.1/24 interface=ether1 network=99.0.0.0